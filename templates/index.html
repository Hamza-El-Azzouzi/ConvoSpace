<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Forum01">
    <meta name="robots" content="index, nofollow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <title>Forum01</title>
    <link href="/static/css/mystyle.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div class="top-bar">
        <div class="container">
            <div class="navbar-menu-left-side239">
                <ul>
                    <li><a href="/"><i aria-hidden="true"></i> Home</a></li>

                    {{ if .LoggedIn }}
                    <li><a href="/create"><i aria-hidden="true"></i> Create A Post</a></li>
                    <li><a href="/logout"><i aria-hidden="true"></i> Log Out</a></li>
                    {{ else }}
                    <li><a href="/login"><i aria-hidden="true"></i> Login Area</a></li>
                    {{ end }}
                </ul>
            </div>
        </div>
    </div>
    <section class="welcome-part-one">
        <div class="container">
            <h2>Welcome to Forum01, Your Hub for Insightful Discussions</h2>
            <p>Have questions that need answers? Or perhaps an idea worth sharing? Forum01 is the perfect place to
                exchange knowledge, get inspired, and explore new perspectives.</p>
            {{ if .LoggedIn }}
            {{ else }}
            <div class="button0239-item">
                <a href="/register">
                    <button class="join92">Join Now</button>
                </a>
            </div>
            {{ end }}
        </div>
    </section>
    <section class="main-content920 container">
        <div id="main">
            {{ range .posts }}
            <div class="question-type2033">
                <div class="row">

                    <div class="right-description893">
                        <h3><a href="detailsPost/{{ .PostID }}" target="_blank">{{ .Title }}</a></h3>
                        <p>{{ .Content }}</p>
                        <hr>
                        <div class="ques-icon-info3293">
                            <i class="fa fa-user" aria-hidden="true"> {{ .Username }} </i>
                            <i class="fa fa-clock-o" aria-hidden="true"> {{ .FormattedDate }}</i>
                            <i class="fa fa-hashtag" aria-hidden="true"> {{ .CategoryName }}</i>
                        </div>
                    </div>
                    <div class="ques-type302">
                        <a href='detailsPost/{{ .PostID }}'>
                            <button><i class="fa fa-comment" aria-hidden="true"></i> {{ .CommentCount }} Comments</button>
                        </a>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
        <aside class="sidebar97239">
            {{ if .LoggedIn }}
            <div class="login-part2389">
                <h4>Welcome, {{ .Username }}</h4>
                <a href="/logout"><button type="button" class="userlogin320">Log Out</button></a>
            </div>
            {{ else }}
            {{ end }}
            {{ if .LoggedIn }}
            <div class="categori-part329">
                <h4>Filter Posts</h4>
                <ul>
                    <label>
                        <input type="radio" name="filter" value="created" id="index-checkbox" />
                        <span class="custom-checkbox">Created Posts</span>
                    </label>
                    <label>
                        <input type="radio" name="filter" value="liked" id="index-checkbox" />
                        <span class="custom-checkbox">Liked Posts</span>
                    </label>
                    <button class="resetFilter userlogin320">Reset Filter</button>
                </ul>
            </div>
            {{ end }}
            <div class="categori-part329">
                <h4>Category</h4>
                <ul class="cate">
                    {{ range .categories }}
                    <label>
                        <input type="radio" value="{{ .ID }}" name="categorie" id="index-checkbox" />
                        <span class="custom-checkbox">{{ .Name }}</span>
                    </label>
                    <br>
                    {{ end }}
                </ul>
                <button class="resetCategorie userlogin320">Reset Category</button>
            </div>
        </aside>
    </section>

    <section class="footer-part">
        <div class="container">
            <p>&copy; 2024 Forum01. All Rights Reserved.</p>
        </div>
    </section>
</body>
<script>
    window.addEventListener('unload', function () {
        navigator.sendBeacon("http://10.1.2.1:8080/checker")
    })



    const btnResetFilter = document.querySelector(".resetFilter")
    const btnResetCategorie = document.querySelector(".resetCategorie")

    if(btnResetFilter){
            btnResetFilter.addEventListener("click", () => {
            const filterby = document.querySelector('input[name="filter"]:checked');
            filterby.checked = false
            handleFilterChange()

        })
    }
    

    btnResetCategorie.addEventListener("click", () => {
        const categories = document.querySelector('input[name="categorie"]:checked');
        categories.checked = false
        handleFilterChange()
    })

    function debounce(func, wait) {
        let timeout;
        return function (...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }

    function handleFilterChange() {
        const filterby = document.querySelector('input[name="filter"]:checked');
        const categorie = document.querySelector('input[name="categorie"]:checked');
        console.log("was clicked here")
        const categoryVal = categorie ? categorie.value : "";
        const filterbyVal = filterby ? filterby.value : "";
        const queryParams = new URLSearchParams({
            filterby: filterbyVal,
            categories: categoryVal
        });

        console.log(queryParams.toString());

        fetch('/filters?' + queryParams.toString(), {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                updateData(data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    document.body.addEventListener("change", debounce(handleFilterChange, 200));

    const updateData = (data) => {
        const mainDiv = document.getElementById("main");
        mainDiv.innerHTML = "";

        if (!data || data.length === 0) {

            const noResultsDiv = document.createElement("div");
            noResultsDiv.classList.add("no-results");
            noResultsDiv.textContent = "No Results Found.";
            mainDiv.appendChild(noResultsDiv);
            return;
        }

        data.forEach(post => {
            const postDiv = document.createElement("div");
            postDiv.classList.add("question-type2033");

            const rowDiv = document.createElement("div");
            rowDiv.classList.add("row");

            const col1 = document.createElement("div");
            col1.classList.add("col-md-1");
            col1.innerHTML = `
                <div class="left-user12923 left-user12923-repeat">
                    <a href="#"><i class="fa fa-check" aria-hidden="true"></i></a>
                </div>`;

            const col9 = document.createElement("div");
            col9.classList.add("col-md-9");
            col9.innerHTML = `
                <div class="right-description893">
                    <div id="que-hedder2983">
                        <h3><a href='detailsPost/${post.post_id}' target="_blank" id="title">${post.title}</a></h3>
                    </div>
                    <div class="ques-details10018">
                        <p id="content">${post.content}</p>
                    </div>
                    <hr>
                    <div class="ques-icon-info3293">
                        <i class="fa fa-user" aria-hidden="true"> ${post.username}</i>
                        <i class="fa fa-clock-o" aria-hidden="true"> ${post.formatted_date}</i>
                        <i class="fa fa-hashtag" aria-hidden="true"> ${post.category_names}</i>
                    </div>
                </div>`;

            const col2 = document.createElement("div");
            col2.classList.add("col-md-2");
            col2.innerHTML = `
                <div class="ques-type302">
                    <a href='detailsPost/${post.post_id}'>
                        <button type="button" class="q-type238">
                            <i class="fa fa-comment" aria-hidden="true"> ${post.comment_count} Comments</i>
                        </button>
                    </a>
                </div>`;

            rowDiv.appendChild(col1);
            rowDiv.appendChild(col9);
            rowDiv.appendChild(col2);
            postDiv.appendChild(rowDiv);
            mainDiv.appendChild(postDiv);
        });
    };
</script>
</html>